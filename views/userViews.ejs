<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TableList</title>
  
    <!-- Google Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
  
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap4.min.css">
  
    <!-- Theme style -->
    <link rel="stylesheet" href="../../dist/css/adminlte.min.css">
  
    <!--  Load jQuery First -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
    <!--  DataTables & Plugins (After jQuery) -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
  
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <!-- for sweatler -->
 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
   <!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
        }
        .main-sidebar 
        {
          position: fixed !important;
          top: 0;
          left: 0;
          height: 100vh;
          overflow-y: auto;
        }
        .profile-header {
            text-align: center;
            padding-bottom: 20px;
        }
        .profile-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .btn-update {
            margin-top: 20px;
        }
        .email-section {
            margin-top: 40px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 10px;
        }
        .profile-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        }
        .profile-item .form-label {
            width: 100%;
        }
        .custom-width {
        width: 100%; 
        height: auto;
        }    
        .content-header {
        padding: 0px;
        }
        .disabled-input{
          background-color: #f2f2f2;
          color: #888;
          border-radius: 4px;
          cursor: not-allowed;
        }
/* Loading Overlay (Initially Hidden) */
#loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex; /* Keep it flex so centering works */
    align-items: center; /* Center vertically */
    justify-content: center; /* Center horizontally */
    z-index: 9999;
    visibility: hidden; /* Use visibility instead of display */
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

/* Loading Spinner */
.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

/* Animation for Spinner */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


/* Success Message (Initially Hidden) */
#success-message {
    display: none; /* Hidden by default */
    background-color: #d4edda;
    color: #155724;
    padding: 10px;
    text-align: center;
    margin-top: 20px;
    border: 1px solid #c3e6cb;
    border-radius: 5px;
}

  </style>
   

  </head>
                        
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
     
      <li class="nav-item">
        <a class="nav-link" data-widget="fullscreen" href="#" role="button">
          <i class="fas fa-expand-arrows-alt"></i>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="#" class="brand-link">
      <!-- <img src="../public/tycho_logo.jpg" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8"> -->
      <span class="brand-text font-weight-light">Tycho DataSets</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item menu-open">
          <li class="nav-item">
            <li class="nav-item">
              <a href="/table-view" class="nav-link">
                <i class="nav-icon fas fa-table"></i>
                <!-- <i class="fas fa-angle-left right"></i> -->
                <!-- <box-icon name='table'></box-icon> -->
                 <p>DataList</p>
              </a>
              
            </li>
            <li class="nav-item">
              <a href="#" id="logout-btn" class="nav-link">
                   <i class="material-icons-outlined me-2">logout</i>
                   <p>LogOut</p>
              </a>
         </li>
            <ul class="nav nav-treeview">
          </li>
            </ul>
          </li>
        
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
    
        
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
       
        <div class="row">
          <div class="col-12">
            <div class="card">
             
            </div>
              <!-- <div class="card">
                </div> -->
                <div class="container mt-5">
                    <div class="profile-container">
                        <div class="employeeDropdown">
                       
                            <form>
                            <div class="row">
                                <div class="col-md-4 profile-item">
                                    <label class="form-label"><strong>Name:</strong></label>
                                    <input type="text" name="fname" class="form-control" id="name" value="<%= response.name %>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="text" class="form-label"><strong>Email:</strong></label>
                                    <input type="text" name="fcontact_email" class="form-control" id="email" value="<%= response.email%>">
                                </div>
                                <div class="col-md-4 profile-item">
                                    <label for="phone" class="form-label"><strong>role:</strong></label>
                                    <input type="text"  name="frole" class="form-control" id="phone" value="<%= response.role%>">
                                </div>

                                <div class="col-md-4 profile-item">
                                  <label for="status" class="form-label"><strong>Status:</strong></label>
                                  <select name="fstatus" class="form-control" id="status">
                                    <option value="pending" <%= response.status === 'pending' ? 'selected' : '' %>>Pending</option>
                                    <option value="Assign" <%= response.status === 'Assign' ? 'selected' : '' %>>Assign</option>
                                </select>
                                
                              </div>
                              
                                
                               
                                <div class="col-md-4 profile-item">
                                    <label for="additional2" class="form-label"><strong>Created At:</strong></label>
                                    <input type="text"  name="fcreated_at" class="form-control disabled-input" id="additional2" value="<%= response.createdAt%>" disabled>
                                </div>
                                
                                
                            </div>
                            <button type="button" data-id="<%= response.id %>" class="btn btn-primary btn-update">Update</button>
                        </form>
                        <!-- Email Section -->
                        <div class="email-section" id="content">
                          <h4>Send an Email.</h4>
                          <form id="emailForm" enctype="multipart/form-data">
                            <div class="mb-3">
                              <label for="fromEmail" class="form-label">From:</label>
                              <input type="email" name="ffremail" class="form-control" id="fromEmail" value="bhutonabhavisyati@gmail.com" readonly>
                            </div>
                            <div class="mb-3">
                              <label for="toEmail" class="form-label">To:</label>
                              <input type="email" name="ftoemail" class="form-control" id="toEmail" placeholder="Enter recipient email" value="<%= response.contact_email %>">
                            </div>
                            <div class="mb-3">
                              <label for="ccEmail" class="form-label">CC:</label>
                              <input type="text" name="fccemail" class="form-control" id="ccEmail" placeholder="Enter CC email">
                            </div>
                            <div class="mb-3">
                              <label for="subject" class="form-label">Subject:</label>
                              <input type="text" name="fsubject" class="form-control" id="subject" placeholder="Enter subject">
                            </div>
                            <div class="mb-3">
                              <label for="editor" class="form-label">Message:</label>
                              <div id="editor" style="height: 200px;"></div>
                              <input type="hidden" name="ftextarea" id="hiddenMessage">
                            </div>
                            <div class="mb-3">
                              <label for="fileAttachment" class="form-label">Attachment:</label>
                              <input type="file" name="attachment" class="form-control" id="fileAttachment">
                            </div>
                            <button type="submit" class="btnsss btn-success">Send Email</button>
                          </form>
                        </div>
                        
                        <!-- Loading Overlay -->
                        <div id="loading-overlay">
                          <div class="spinner"></div>
                        </div>
                        
                        <!-- Success Message -->
                        <div id="success-message"> Email Sent Successfully!</div>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  
  <!-- /.content-wrapper -->
  <footer class="main-footer" style="text-align: center; justify-content: center;">
    <strong>Copyright &copy; 2025-2035 <a href="https://tychotechnologies.com/">tychotechnologies</a>.</strong>
    All rights reserved.
  </footer>
  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="../../plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- DataTables  & Plugins -->
<script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
<script src="../../plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="../../plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="../../plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<script src="../../plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="../../plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
<script src="../../plugins/jszip/jszip.min.js"></script>
<script src="../../plugins/pdfmake/pdfmake.min.js"></script>
<script src="../../plugins/pdfmake/vfs_fonts.js"></script>
<script src="../../plugins/datatables-buttons/js/buttons.html5.min.js"></script>
<script src="../../plugins/datatables-buttons/js/buttons.print.min.js"></script>
<script src="../../plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../dist/js/demo.js"></script>
<!-- Page specific script -->
  
</body>

<script>
    $(document).on("click", ".btn-update", function () {
        const id = $(this).data("id");
        console.log("Update button clicked - ID:", id);

        if (!id) {
            console.error("Error: No ID found on button.");
            Swal.fire({ icon: "error", text: "Invalid item ID." });
            return;
        }

        // Gather form data with correct field names
        const data = {
            id,
            fname: $('input[name="fname"]').val(),
            fcontact_email: $('input[name="fcontact_email"]').val(),
            frole: $('input[name="frole"]').val(),
            fstatus: $('select[name="fstatus"]').val(),

            fassign: $('input[name="fassign"]').val(),
        };

        console.log("Data being sent:", data); // Debugging

        Swal.fire({
            title: "Do you want to update?",
            showCancelButton: true,
            confirmButtonText: "Update",
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `/updateUser/${id}`,
                    type: "PUT", // Use PUT for updates
                    data: JSON.stringify(data),
                    contentType: "application/json",
                    success: function (response) {
                        console.log("Server Response:", response);

                        if (response.status === "unauthorized") {
                            // If session is expired, redirect to login immediately
                            window.location.href = "/login";
                        } else if (response.status === "success") {
                            // Show success message and redirect to /table-view when user clicks OK
                            Swal.fire({
                                icon: "success",
                                text: response.message,
                                confirmButtonText: "OK",
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = "/userList";
                                }
                            });
                        } else {
                            Swal.fire({
                                icon: "error",
                                title: "Oops...",
                                text: response.message,
                            });
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("AJAX Error:", status, error, xhr.responseText);
                        Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Something went wrong. Please try again later.",
                        });
                    },
                });
            }
        });
    });
</script>

  <script>
    $(document).ready(function () {
      // Custom toolbar with an "Attach File" button
      var toolbarOptions = [
        [{ 'font': [] }, { 'size': [] }],
        ['bold', 'italic', 'underline', 'strike'],
        [{ 'color': [] }, { 'background': [] }], // Color options
        [{ 'script': 'sub' }, { 'script': 'super' }],
        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
        [{ 'align': [] }],
        ['blockquote', 'code-block'],
        ['clean']
    ];

    // Initialize Quill Editor with toolbar
    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: toolbarOptions
        }
    });
    $(document).on("submit", "#emailForm", function (e) {
    e.preventDefault();

    // Get Quill content as HTML
    let messageHtml = quill.root.innerHTML;
    $("#hiddenMessage").val(messageHtml);

    Swal.fire({
        title: "Are you sure?",
        text: "Do you want to send this email?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Send",
        cancelButtonText: "Cancel"
    }).then((result) => {
        if (result.isConfirmed) {
            // Show Loader (properly centered)
            $("#loading-overlay").css({"visibility": "visible", "opacity": "1"});  
            $(".btnsss").prop("disabled", true);

            let formData = new FormData($("#emailForm")[0]);

            $.ajax({
    url: "/sendEmail",
    type: "POST",
    data: formData,
    contentType: false,
    processData: false,
    success: function (response) {
        setTimeout(() => {
            $("#loading-overlay").css({"visibility": "hidden", "opacity": "0"}); // Hide loader
            $("#success-message").fadeIn().delay(3000).fadeOut(); // Show success message
            $(".btnsss").prop("disabled", false);
            Swal.fire("Sent!", "Your email was sent successfully.", "success").then(() => {
                location.reload(); // Reload the page after the alert is closed
            });
        }, 500);
    },
    error: function (error) {
        setTimeout(() => {
            $("#loading-overlay").css({"visibility": "hidden", "opacity": "0"}); // Hide loader
            $(".btnsss").prop("disabled", false);
            Swal.fire("Error!", "Something went wrong. Please try again.", "error");
        }, 500);
    }
});

        }
    });
});

});
  </script>




</html>
